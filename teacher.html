<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HSC VLMS - Teacher Dashboard</title>
    <style>
        body { font-family: sans-serif; margin: 0; background: #f4f4f4; display: flex; height: 100vh; }
        .sidebar { width: 220px; background: #003366; color: white; padding: 20px; }
        .main { flex-grow: 1; padding: 40px; }
        .status-bar { padding: 15px; background: #ffc107; margin-bottom: 20px; border-radius: 5px; font-weight: bold; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2>HSC VLMS</h2>
        <button onclick="handleAuthClick()" id="sync-btn" style="width:100%; padding:10px; cursor:pointer;">Sync Classroom</button>
        <p><a href="index.html" style="color:white;">Logout</a></p>
    </div>

    <div class="main">
        <div id="conn-status" class="status-bar">Connecting to Google...</div>
        <h1>My Classes</h1>
        <div id="courses-list">If this stays blank, check your internet or API Key.</div>
    </div>

    <script>
        const CLIENT_ID = '1042342028327-pliq405qso25f01br911ksqhn8f3jkgk.apps.googleusercontent.com';
        const API_KEY = 'AIzaSyC1pl8M0jb_Os4eODhnuKmzKqQC4Ommxi4';
        
        let tokenClient;

        async function initGapi() {
            try {
                await gapi.client.init({
                    apiKey: API_KEY,
                    discoveryDocs: ["https://classroom.googleapis.com/$discovery/rest?version=v1"],
                });
                document.getElementById('conn-status').innerText = "Google API: Ready";
                document.getElementById('conn-status').style.background = "#27ae60";
            } catch (e) {
                document.getElementById('conn-status').innerText = "Load Error: Verify API Key & Library Settings";
            }
        }

        function handleAuthClick() {
            tokenClient.requestAccessToken({prompt: 'consent'});
        }

        async function listCourses() {
            const resp = await gapi.client.classroom.courses.list();
            const courses = resp.result.courses || [];
            const list = document.getElementById('courses-list');
            list.innerHTML = courses.map(c => `<div><strong>${c.name}</strong></div>`).join('') || "No classes found.";
        }

        // Initialize libraries manually
        function start() {
            gapi.load('client', initGapi);
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: 'https://www.googleapis.com/auth/classroom.courses.readonly',
                callback: (resp) => { if (resp.access_token) listCourses(); },
            });
        }
    </script>
    
    <script async defer src="https://apis.google.com/js/api.js" onload="start()"></script>
    <script async defer src="https://accounts.google.com/gsi/client"></script>
</body>
</html>
